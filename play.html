<html>
<head>
<style type="text/css">
body {
    background: black;
    color: white;
}
#board {
    margin-left: auto;
    margin-right: auto;
    font-size: 300%;
    border-spacing: 5px;
}
.src {
    background: #0f0 !important;
    box-shadow: 0px 0px 20px #0f0 !important;
}
.dst {
    background: radial-gradient(circle at center,
        #228 0%,
        #117 50%,
        #006 100%
    ) !important;
    background: #006 !important;
}
.dst:hover {
    box-shadow: 0px 0px 20px #00f !important;
    background: radial-gradient(circle at center,
        #22f 0%,
        #11e 50%,
        #00d 100%
    ) !important;
    background: #00d !important;
}
.cell {
    width: 60px;
    text-align: center;
    transition: 0.5s;
    cursor: pointer;
}
.pool {
}
.gap {
}
.edge {
    background: radial-gradient(circle at center,
        #282830 0%,
        #202028 50%,
        #181820 100%
    );
}
.arena {
    background: radial-gradient(circle at center,
        #404048 0%,
        #383840 50%,
        #303038 100%
    );
}
</style>
<head>
<body>
  <table style="height: 100%; width: 100%">
    <tr>
      <td style="vertical-align: middle">
        <table id="board">
          <tr>
            <td onclick="clicked(0, 0)" id="cell_0_0" class="cell pool src">&#x2655;</td>
            <td class="cell gap"></td>
            <td onclick="clicked(0, 1)" id="cell_0_1" class="cell edge"></td>
            <td onclick="clicked(0, 2)" id="cell_0_2" class="cell edge"></td>
            <td onclick="clicked(0, 3)" id="cell_0_3" class="cell edge"></td>
            <td onclick="clicked(0, 4)" id="cell_0_4" class="cell edge"></td>
            <td onclick="clicked(0, 5)" id="cell_0_5" class="cell edge"></td>
            <td class="cell gap"></td>
            <td onclick="clicked(0, 6)" id="cell_0_6" class="cell pool">&#x265B;</td>
          </tr>
          <tr>
            <td onclick="clicked(1, 0)" id="cell_1_0" class="cell pool">&#x2658;</td>
            <td class="cell gap"></td>
            <td onclick="clicked(1, 1)" id="cell_1_1" class="cell edge dst"></td>
            <td onclick="clicked(1, 2)" id="cell_1_2" class="cell arena"></td>
            <td onclick="clicked(1, 3)" id="cell_1_3" class="cell arena"></td>
            <td onclick="clicked(1, 4)" id="cell_1_4" class="cell arena"></td>
            <td onclick="clicked(1, 5)" id="cell_1_5" class="cell edge"></td>
            <td class="cell gap"></td>
            <td onclick="clicked(1, 6)" id="cell_1_6" class="cell pool">&#x265E;</td>
          </tr>
          <tr>
            <td onclick="clicked(2, 0)" id="cell_2_0" class="cell pool">&#x2659;</td>
            <td class="cell gap"></td>
            <td onclick="clicked(2, 1)" id="cell_2_1" class="cell edge dst"></td>
            <td onclick="clicked(2, 2)" id="cell_2_2" class="cell arena"></td>
            <td onclick="clicked(2, 3)" id="cell_2_3" class="cell arena"></td>
            <td onclick="clicked(2, 4)" id="cell_2_4" class="cell arena"></td>
            <td onclick="clicked(2, 5)" id="cell_2_5" class="cell edge"></td>
            <td class="cell gap"></td>
            <td onclick="clicked(2, 6)" id="cell_2_6" class="cell pool">&#x265F;</td>
          </tr>
          <tr>
            <td onclick="clicked(3, 0)" id="cell_3_0" class="cell pool">&#x2659;</td>
            <td class="cell gap"></td>
            <td onclick="clicked(3, 1)" id="cell_3_1" class="cell edge"></td>
            <td onclick="clicked(3, 2)" id="cell_3_2" class="cell arena"></td>
            <td onclick="clicked(3, 3)" id="cell_3_3" class="cell arena"></td>
            <td onclick="clicked(3, 4)" id="cell_3_4" class="cell arena"></td>
            <td onclick="clicked(3, 5)" id="cell_3_5" class="cell edge"></td>
            <td class="cell gap"></td>
            <td onclick="clicked(3, 6)" id="cell_3_6" class="cell pool">&#x265F;</td>
          </tr>
          <tr>
            <td onclick="clicked(4, 0)" id="cell_4_0" class="cell pool">&#x2659;</td>
            <td class-"cell gap"></td>
            <td onclick="clicked(4, 1)" id="cell_4_1" class="cell edge"></td>
            <td onclick="clicked(4, 2)" id="cell_4_2" class="cell edge"></td>
            <td onclick="clicked(4, 3)" id="cell_4_3" class="cell edge"></td>
            <td onclick="clicked(4, 4)" id="cell_4_4" class="cell edge"></td>
            <td onclick="clicked(4, 5)" id="cell_4_5" class="cell edge"></td>
            <td class="cell gap"></td>
            <td onclick="clicked(4, 6)" id="cell_4_6" class="cell pool">&#x265F;</td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript">
var directions = [
    {
        y: 1,
        x: 0,
    },
    {
        y: 1,
        x: 1,
    },
    {
        y: 0,
        x: 1,
    },
    {
        y: -1,
        x: 1,
    },
    {
        y: -1,
        x: 0,
    },
    {
        y: -1,
        x: -1,
    },
    {
        y: 0,
        x: -1,
    },
    {
        y: 1,
        x: -1,
    },
];

var edge_squares = [
    {
        y: 0,
        x: 1,
    },
    {
        y: 0,
        x: 2,
    },
    {
        y: 0,
        x: 3,
    },
    {
        y: 0,
        x: 4,
    },
    {
        y: 0,
        x: 5,
    },
    {
        y: 1,
        x: 1,
    },
    {
        y: 1,
        x: 5,
    },
    {
        y: 2,
        x: 1,
    },
    {
        y: 2,
        x: 5,
    },
    {
        y: 3,
        x: 1,
    },
    {
        y: 3,
        x: 5.
    },
    {
        y: 4,
        x: 1,
    },
    {
        y: 4,
        x: 2,
    },
    {
        y: 4,
        x: 3,
    },
    {
        y: 4,
        x: 4,
    },
    {
        y: 4,
        x: 5,
    },
];

var can_move_in_direction = function(board, cy, cx, dy, dx) {
    var y = cy
    var x = cx;
    var rr = [];
    while (true) {
        y += dy;
        if (y < 1 || 5 < y) {
            break;
        }
        x += dx;
        if (x < 1 || 5 < x) {
            break;
        }
        var r = {
            y: y,
            x: x,
        };
        rr.push(r);
    }
    var limit = Math.abs(board[cy][cx]);
    var has_room = false;
    for (var i = 0; i < rr.length; ++i) {
        var r = rr[i];
        var piece = board[r.y][r.x];
        if (!piece) {
            has_room = true;
            break;
        }
        if (limit < Math.abs(piece)) {
            return false;
        }
    }
    return has_room;
};

var get_adjancent_dsts = function(board, cy, cx) {
    var dsts = [];
    for (var i = 0; i < directions.length; ++i) {
        var d = directions[i];
        if (!can_move_in_direction(board, cy, cx, d.y, d.x)) {
            continue;
        }
        var dst = {
            y: cy + d.y,
            x: cx + d.x,
        };
        dsts.push(dst);
    }
    return dsts;
};

var get_edge_dsts = function(board) {
    var dsts = [];
    for (var i = 0; i < edge_squares.length; ++i) {
        var dst = edge_squares[i];
        if (!board[dst.y][dst.x]) {
            dsts.push(dst);
        }
    }
    return dsts;
};

var square_to_moves = function(board, y, x) {
    if (1 <= x && x <= 5) {
        return get_adjacent_dsts(board, y, x);
    } else {
        return get_edge_dsts(board);
    }
};

var board_to_moves = function(board) {
    var src2dsts = {};
    for (var y = 0; y < 5; ++y) {
        for (var x = 0; x < 7; ++x) {
            if (board[y][x] <= 0) {
                continue;
            }
            src2dsts[y + '_' + x] = square_to_moves(board, y, x);
        }
    }
    return src2dsts;
};

var redraw_board = function(board, src2dsts) {
    $('.cell').removeClass('src');
    $('.cell').removeClass('dst');
    for (var src in src2dsts) {
        $('#cell_' + src).addClass('dst');
    }
};

var board = [
    [3, 0, 0, 0, 0, 0, -3],
    [2, 0, 0, 0, 0, 0, -2],
    [1, 0, 0, 0, 0, 0, -1],
    [1, 0, 0, 0, 0, 0, -1],
    [1, 0, 0, 0, 0, 0, -1],
];

var src2dsts = board_to_moves(board);

redraw_board(board, src2dsts);
  </script>
</body>
</html>
